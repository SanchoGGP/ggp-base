<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Sancho match record</title>

    <script type='text/javascript' src='//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js'></script>
    <script src="//code.highcharts.com/highcharts.js"></script>

    <script type='text/javascript'>//<![CDATA[
      $(function ()
      {
          Highcharts.setOptions(
          {
            chart:   {marginRight: 80},
            credits: {
                       text: 'Sancho Stats',
                       href: 'http://sanchoggp.blogspot.com/'
                     }
          });

          $('#MEM').highcharts(
          {
            title:   {text: 'Memory'},
            xAxis:   {type: 'datetime'},
            yAxis:   [
                       {
                         title: {text: 'bytes'},
                         min: 0
                       }
                    ]
          });

          $('#GC').highcharts(
          {
            title: {text: 'Garbage Collection'},
            xAxis: {type: 'datetime'},
            yAxis: [
                     {
                       title:    {text: 'ms'},
                       min:      0
                     },
                     {
                       title:    {text: 'count'},
                       opposite: true,
                       min:      0
                     }
                   ]
          });

          $('#PERF').highcharts(
          {
            title: {text: 'Performance'},
            xAxis: {type: 'datetime'},
            yAxis: [
                     {
                       title: {text: 'Expansions/ms'},
                       min:   0
                     },
                     {
                       title: {text: 'Rollouts/expansion'},
                       opposite: true,
                       min: 0
                     }
                   ]
          });
      });

      function receiveMessage(xiEvent)
      {
        lLogData = JSON.parse(xiEvent.data);
        $.each(lLogData.statistics, function()
        {
          if (this.showon === 'NONE')
          {
            if (this.name === 'Turn')
            {
              var lMatchStartTime = this.data[0][0];
              var lMatchEndTime   = this.data[this.data.length - 1][0];
              $.each(this.data, function()
              {
                var lTurnTime = this[0];
                var lTurnNum  = this[1];
                $('.SanchoGraph').each(function(xiIndex, xiGraph)
                {
                  $(xiGraph).highcharts().xAxis[0].addPlotLine(
                  {
                    color:     '#e0e0e0',
                    dashStyle: 'ShortDash',
                    value:     lTurnTime,
                    width:     1,
                    label:     {text: '' + lTurnNum}
                  });
                  $(xiGraph).highcharts().xAxis[0].setExtremes(lMatchStartTime,
                                                               lMatchEndTime);
                });
              });
              // Add plot lines to all graphs
            }
          }
          else
          {
            $('#' + this.showon).highcharts().addSeries(this);
          }
        });
      }

      window.addEventListener("message", receiveMessage, false);
      parent.postMessage("", "*");

      //]]>
    </script>
  </head>

  <body>
    <div id="MEM"  class="SanchoGraph" style="height: 300px"></div>
    <div id="GC"   class="SanchoGraph" style="height: 300px"></div>
    <div id="PERF" class="SanchoGraph" style="height: 300px"></div>
  </body>

</html>

